[connectivity]
# Instantiate a single shared mm2s kernel.  An AXI4-Stream switch fans the
# output of this kernel to the various AI Engine and PL sinks.
nk=mm2s_pl:1:mm2s
nk=leaky_relu_pl:2:relu,relu2
nk=leaky_splitter_pl:1:splitter
nk=s2mm_pl:1:s2mm_out
nk=axis_switch:1:mm2s_switch

# --- Stream Connections ---
# mm2s -> AXI4-Stream switch
stream_connect=mm2s.s:mm2s_switch.S00_AXIS

# Switch outputs to the AIE/PL ports
stream_connect=mm2s_switch.M00_AXIS:ai_engine_0.layer0_in
stream_connect=mm2s_switch.M01_AXIS:ai_engine_0.layer0_weights
stream_connect=mm2s_switch.M02_AXIS:ai_engine_0.layer1_weights_0
stream_connect=mm2s_switch.M03_AXIS:ai_engine_0.layer1_weights_1
stream_connect=mm2s_switch.M04_AXIS:relu.bias_stream
stream_connect=mm2s_switch.M05_AXIS:relu2.bias_stream

# Feedback loop: AIE output -> leaky_relu -> splitter -> AIE input for the next layer
stream_connect=ai_engine_0.layer0_out:relu.in_stream
stream_connect=relu.out_stream:splitter.in_stream
stream_connect=splitter.out_stream_0:ai_engine_0.layer1_in_0
stream_connect=splitter.out_stream_1:ai_engine_0.layer1_in_1

# Final output from the AIE graph passes through a second LeakyReLU before
# being written to memory
stream_connect=ai_engine_0.layer1_out:relu2.in_stream
stream_connect=relu2.out_stream:s2mm_out.s


