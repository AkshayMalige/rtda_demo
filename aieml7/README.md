# AI Engine-ML Graph: `dense1 → leaky_relu → dense2 → leaky_relu → roll_concat → dense3`

This directory implements a three-layer neural network graph with the following pipeline:

1. **`dense1`** (8×128) – first matrix-vector multiply producing hidden activations
2. **`bias_add`** – adds bias to dense1 output
3. **`leaky_relu`** – activation function (AIE kernel)
4. **`window_split_128_to_64x2`** – splits 128-element output into two 64-element windows for cascaded dense2
5. **`dense2`** (128×128, cascade length=2) – second matrix-vector multiply
6. **`leaky_relu`** – activation function on dense2 output
7. **`roll_concat`** – repeats the 128-element output 6 times to create 768 elements
8. **`window_split_768_to_128x6`** – splits 768 elements into six 128-element windows for cascaded dense3
9. **`dense3`** (128×768, cascade length=6) – third matrix-vector multiply producing final 128-element output

All weights are loaded via RTP (runtime parameters) rather than PLIO files.

## Directory Layout

```
├── graph.cpp                       # Instantiates `NeuralNetworkGraph` for simulation
├── graph.h                         # Graph definition with RTP weight connections
├── leaky_relu.cpp/.h               # Leaky ReLU activation kernel
├── bias_add.cpp/.h                 # Bias addition kernel
├── window_split_128_to_64x2.cpp/.h # Window splitter for dense2 cascade
├── window_split_768_to_128x6.cpp/.h # Window splitter for dense3 cascade
├── roll_concat.cpp/.h              # Repeats 128→768 for dense3 input
└── Makefile
```

## Build

Compile the AI Engine graph using:

```bash
cd aieml6
make graph TARGET=hw       # or TARGET=hw_emu
```

This produces `Work/libadf.a` containing the compiled graph.

## Simulation

Run AI Engine simulation:

```bash
make sim
```

## Data Flow

### Input/Output PLIO
- **Input**: `layer0_in` reads from `../data/embed_input_data.txt` (8 floats)
- **Output**: `layer1_out` writes to `../data/embed_dense1_output.txt` (128 floats)

### Runtime Parameters (RTP)
Weights are provided via RTP connections rather than PLIO files:
- `matrixA_dense0_rtp`: 8×128 weights for dense1
- `bias_dense0_rtp`: 128-element bias for dense1
- `matrixA_dense1_rtp[2]`: Two 64×128 weight matrices for cascaded dense2
- Dense3 weights (128×768, 6-way cascade) are connected but not shown in current RTP ports

### Processing Pipeline
```
input(8) → dense1(8×128) → bias_add → leaky_relu → split(128→64×2) →
dense2(128×128) → leaky_relu → roll_concat(128→768) → split(768→128×6) →
dense3(128×768) → output(128)
```

Test data is generated by `../data/generate_test_data.py`.