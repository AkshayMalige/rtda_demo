# AI Engine-ML Graph: Two-Layer Neural Network with Activation

This directory implements a two-layer neural network graph (`dense1 → bias → leaky_relu → split → dense2 → bias → leaky_relu`), designed as a building block for the larger multi-layer architecture.

## Architecture

### Pipeline
1. **`dense1`** (8×128) – First matrix-vector multiply producing 128 hidden activations
2. **`bias_add`** – Adds bias to dense1 output
3. **`leaky_relu`** – Activation function (AIE kernel)
4. **`window_split_128_to_64x2`** – Splits 128-element output into two 64-element windows for cascaded dense2
5. **`dense2`** (128×128, cascade length=2) – Second matrix-vector multiply producing 128 outputs
6. **`bias_add`** – Adds bias to dense2 output
7. **`leaky_relu`** – Final activation function

### Layer Configurations
- **Layer 1**: 8×128 dense layer (INPUT_SIZE=8, HIDDEN_SIZE=128)
- **Layer 2**: 128×128 dense layer with 2-way cascade (TP_CASC_LEN_LAYER2=2)
- **Activation**: Leaky ReLU with slope 0.1
- All weights loaded via RTP (runtime parameters)

## Directory Layout

```
├── graph.cpp                       # Instantiates NeuralNetworkGraph for simulation
├── graph.h                         # Graph definition with RTP weight connections
├── leaky_relu.cpp/.h               # Leaky ReLU activation kernel
├── bias_add.cpp/.h                 # Bias addition kernel
├── window_split_128_to_64x2.cpp/.h # Window splitter for dense2 cascade
├── window_split_768_to_*.h         # Unused window splitter utilities
├── roll_concat.cpp/.h              # Unused roll-concat utility
└── Makefile                        # Build targets
```

## Build & Simulation

### Compile AI Engine Graph
```bash
cd aieml6
make graph TARGET=hw       # or TARGET=hw_emu
```
Produces `Work/libadf.a` containing the compiled graph.

### Run AI Engine Simulation
```bash
make sim
```

## Data Flow

### Input/Output PLIO
- **Input**: `layer0_in` reads from `../data/embed_input_data.txt` (8 floats)
- **Output**: `layer1_out` writes to `../data/embed_dense1_output.txt` (128 floats)

### Runtime Parameters (RTP)
Weights are provided via RTP connections:
- `matrixA_dense0_rtp`: 8×128 weights for dense1
- `bias_dense0_rtp`: 128-element bias for dense1
- `matrixA_dense1_rtp[2]`: Two 64×128 weight matrices for cascaded dense2
- `bias_dense1_rtp`: 128-element bias for dense2

### Processing Pipeline
```
input(8) → dense1(8×128) → bias_add → leaky_relu → split(128→64×2) →
dense2(128×128, casc=2) → bias_add → leaky_relu → output(128)
```

## Notes
- Test data is generated by `../data/generate_test_data.py`
- This graph serves as a building block tested independently before integration into larger architectures (aieml7, aieml9)
