# AI Engine-ML Graph: `dense1 → dense2`

This directory hosts the **embedding** graph of the project. It implements the first
two dense layers of the network while leaky ReLU activations run in the
programmable logic. Later stages are implemented in
[`aieml2/`](../aieml2/README.md) and [`aieml3/`](../aieml3/README.md).

1. **`dense1`** – matrix-vector multiply producing the hidden activations.
2. **`dense2`** – second matrix-vector multiply generating the final output that feeds
   the PL leaky ReLU.

## Directory Layout

```
├── graph.cpp    # Instantiates `NeuralNetworkGraph` and drives GMIO simulation
├── graph.h      # Graph definition and GMIO connections
└── Makefile
```

## Build

The supplied `Makefile` wraps the standard build flow (now using `v++` so the
`aie.cfg` partition directives take effect). From the repository root, compile
the graph with:

```bash
cd aieml4
make graph TARGET=hw       # or TARGET=hw_emu
```

To invoke the compiler directly without the wrapper:

```bash
cd aieml4
v++ -c --mode aie --target hw graph.cpp \
    --platform=${PLATFORM} \
    --work_dir=Work \
    --config=aie.cfg \
    --include="./" \
    --include="../common" \
    --include="../dsp_lib/L1/src/aie" \
    --include="../dsp_lib/L1/include/aie" \
    --include="../dsp_lib/L2/include/aie"
```

Both commands produce `Work/libadf.a` inside this directory.

## Simulation

After a successful build, run cycle-approximate simulation:

```bash
make sim                  # uses `aiesimulator` under the hood
# or run manually
# aiesimulator --pkg-dir=Work --profile --dump-vcd=foo
```

## Data Flow

The GMIO streams consumed by the graph now draw data from the project-parent
[`../data/`](../../data) directory. They are generated by
[`data/generate_test_data.py`](../data/generate_test_data.py), which
creates:

- `input_data.txt` and `weights_dense1.txt` for `dense1`
- `leakyrelu_output_part*.txt` and `weights_dense2_part*.txt` for the cascaded
  `dense2`

`graph.h` exposes GMIO ports for each stream, while `graph.cpp` loads the files
at runtime and moves the data via the non-blocking GMIO APIs (relative to
`DATA_DIR`). For environment
setup and detailed data creation instructions, see the
[top-level README](../README.md).


<!-- -0.250920
0.901429
0.463988
0.197317
-0.687963
-0.688011
-0.883833
0.732352 -->