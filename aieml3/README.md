# AI Engine-ML Graph: `dense1 → dense2`

This directory mirrors the original [`aieml`](../aieml) design but targets
**float16** data throughout. The reduction in weight size allows the second
`dense2` layer (128×128) to fit within a single AI Engine-ML tile, removing the
need for cascade connections. Activations remain in the programmable logic:

1. **`dense1`** – 8×128 matrix‑vector multiply producing the hidden activations.
2. **`dense2`** – 128×128 matrix‑vector multiply generating the final output.

## Directory Layout

```
├── graph.cpp    # Instantiates `NeuralNetworkGraph` and runs it for simulation
├── graph.h      # Graph definition and PLIO connections
├── include.h    # Common dimension definitions and compile-time constants
└── Makefile
```

## Build

The supplied `Makefile` wraps the standard build flow. From the repository
root, compile the graph with:

```bash
cd aieml3
make graph TARGET=hw       # or TARGET=x86sim
```

To invoke the compiler directly without the wrapper:

```bash
cd aieml3
v++ --compile --mode aie --target hw ./graph.cpp \
    --platform=${PLATFORM} -I./data
```

Both commands produce `Work/libadf.a` inside this directory.

## Simulation

After a successful build, run cycle-approximate simulation:

```bash
make sim TARGET=hw        # uses `aiesimulator` under the hood
# or run manually
# aiesimulator --pkg-dir=Work --profile --dump-vcd=foo
```

## Data Flow

The PLIO files consumed by the graph reside in the repository-level
[`data/`](../data) directory. They are generated by
[`data/generate_test_data.py`](../data/generate_test_data.py), which
creates:

- `input_data.txt` and `weights_dense1.txt` for `dense1`
- `leakyrelu_output_part0.txt` and `weights_dense2_part0.txt` for the single‑tile
  `dense2`

`graph.h` connects each PLIO port to these files (relative to `DATA_DIR`) so
that simulation reads the pre-generated values at runtime. For environment
setup and detailed data creation instructions, see the
[top-level README](../README.md).
